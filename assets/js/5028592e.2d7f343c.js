"use strict";(self.webpackChunkl_1_l_blog=self.webpackChunkl_1_l_blog||[]).push([[1838],{3905:function(e,n,t){t.d(n,{Zo:function(){return o},kt:function(){return _}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=a.createContext({}),c=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},o=function(e){var n=c(e.components);return a.createElement(i.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,o=p(e,["components","mdxType","originalType","parentName"]),u=c(t),_=r,d=u["".concat(i,".").concat(_)]||u[_]||m[_]||l;return t?a.createElement(d,s(s({ref:n},o),{},{components:t})):a.createElement(d,s({ref:n},o))}));function _(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,s=new Array(l);s[0]=u;var p={};for(var i in n)hasOwnProperty.call(n,i)&&(p[i]=n[i]);p.originalType=e,p.mdxType="string"==typeof e?e:r,s[1]=p;for(var c=2;c<l;c++)s[c]=t[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},8040:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return p},contentTitle:function(){return i},metadata:function(){return c},toc:function(){return o},default:function(){return u}});var a=t(7462),r=t(3366),l=(t(7294),t(3905)),s=["components"],p={title:"\u64cd\u4f5c\u7cfb\u7edf OS Lab4 \u5b66\u4e60\u7b14\u8bb0"},i=void 0,c={unversionedId:"BUAA/\u8bfe\u7a0b/\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c/\u64cd\u4f5c\u7cfb\u7edf-OS-Lab4-\u5b66\u4e60\u7b14\u8bb0",id:"BUAA/\u8bfe\u7a0b/\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c/\u64cd\u4f5c\u7cfb\u7edf-OS-Lab4-\u5b66\u4e60\u7b14\u8bb0",isDocsHomePage:!1,title:"\u64cd\u4f5c\u7cfb\u7edf OS Lab4 \u5b66\u4e60\u7b14\u8bb0",description:"\u4eca\u5929\u7684\u5185\u5bb9\u662fOS Lab4\u7684\u5b66\u4e60\u590d\u4e60\u7b14\u8bb0\u2026\u2026\u8fd9\u5468\u7684OO\u5f3a\u6d4b\u53ea\u62ff\u4e8620\u5206\uff0c\u4e4b\u524d\u7684\u6240\u6709\u4f18\u5316\u52aa\u529b\u76f4\u63a5\u767d\u7ed9\u2026\u2026\u84dd\u7626\u3002",source:"@site/docs/BUAA/\u8bfe\u7a0b/\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c/\u64cd\u4f5c\u7cfb\u7edf-OS-Lab4-\u5b66\u4e60\u7b14\u8bb0.md",sourceDirName:"BUAA/\u8bfe\u7a0b/\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c",slug:"/BUAA/\u8bfe\u7a0b/\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c/\u64cd\u4f5c\u7cfb\u7edf-OS-Lab4-\u5b66\u4e60\u7b14\u8bb0",permalink:"/BUAA/\u8bfe\u7a0b/\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c/\u64cd\u4f5c\u7cfb\u7edf-OS-Lab4-\u5b66\u4e60\u7b14\u8bb0",tags:[],version:"current",frontMatter:{title:"\u64cd\u4f5c\u7cfb\u7edf OS Lab4 \u5b66\u4e60\u7b14\u8bb0"},sidebar:"tutorialSidebar",previous:{title:"\u64cd\u4f5c\u7cfb\u7edf OS Lab4-extra \u5b66\u4e60\u7b14\u8bb0",permalink:"/BUAA/\u8bfe\u7a0b/\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c/\u64cd\u4f5c\u7cfb\u7edf-OS-Lab4-extra-\u5b66\u4e60\u7b14\u8bb0"},next:{title:"\u64cd\u4f5c\u7cfb\u7edf OS Lab4 \u5b9e\u9a8c\u62a5\u544a",permalink:"/BUAA/\u8bfe\u7a0b/\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c/\u64cd\u4f5c\u7cfb\u7edf-OS-Lab4-\u5b9e\u9a8c\u62a5\u544a"}},o=[{value:"\u7cfb\u7edf\u8c03\u7528",id:"\u7cfb\u7edf\u8c03\u7528",children:[{value:"Exercise 4.1",id:"exercise-41",children:[],level:3},{value:"Thinking 4.1",id:"thinking-41",children:[],level:3},{value:"Exercise 4.2",id:"exercise-42",children:[],level:3},{value:"Exercise 4.3",id:"exercise-43",children:[],level:3}],level:2}],m={toc:o};function u(e){var n=e.components,t=(0,r.Z)(e,s);return(0,l.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"\u4eca\u5929\u7684\u5185\u5bb9\u662fOS Lab4\u7684\u5b66\u4e60\u590d\u4e60\u7b14\u8bb0\u2026\u2026\u8fd9\u5468\u7684OO\u5f3a\u6d4b\u53ea\u62ff\u4e8620\u5206\uff0c\u4e4b\u524d\u7684\u6240\u6709\u4f18\u5316\u52aa\u529b\u76f4\u63a5\u767d\u7ed9\u2026\u2026\u84dd\u7626\u3002"),(0,l.kt)("p",null,"\u6240\u4ee5OS\u4e0d\u80fd\u518d\u4e00\u77e5\u534a\u89e3\u4e86\uff0c\u5728\u4e00\u5f00\u59cb\u540c\u6837\u653e\u4e0b\u5b66\u957f\u535a\u5ba2\u4e0e\u8bfe\u7a0b\u6307\u5bfc\u4e2d\u5fc3\u7684\u89c6\u9891\u2014\u2014"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/SivilTaram/p/os_lab4.html"},"https://www.cnblogs.com/SivilTaram/p/os_lab4.html")),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/sharinka0715/p/10776860.html"},"https://www.cnblogs.com/sharinka0715/p/10776860.html")),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://ausar.xyz/index.php/archives/77/"},"https://ausar.xyz/index.php/archives/77/")),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/Yzx835/p/10775984.html"},"https://www.cnblogs.com/Yzx835/p/10775984.html")),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://blog.csdn.net/qq_36740940/article/details/89523911"},"https://blog.csdn.net/qq_36740940/article/details/89523911")),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://blog.csdn.net/weixin_44689094/article/details/105893744"},"https://blog.csdn.net/weixin_44689094/article/details/105893744")),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://blog.csdn.net/weixin_41412192/article/details/89522232"},"https://blog.csdn.net/weixin_41412192/article/details/89522232")),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://www.yizhibo.com/l/z3OzSureOCT8QEQT.html"},"https://www.yizhibo.com/l/z3OzSureOCT8QEQT.html"))),(0,l.kt)("p",null,"\u5728\u8fd9\u4e00\u8282\u7684\u5b9e\u9a8c\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528\u673a\u5236\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\u5b9e\u73b0\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u673a\u5236\u548c\u4e00\u4e2a\u91cd\u8981\u7684\u7cfb\u7edf\u8c03\u7528fork\u3002\u5728\u68b3\u7406\u535a\u5ba2\u7684\u65f6\u5019\uff0c\u6709\u7684\u5b66\u957f\u662f\u6839\u636e\u8fd0\u884c\u987a\u5e8f\u6765\u603b\u7ed3\u7684\uff0c\u6211\u76ee\u524d\u8fd8\u662f\u5148\u8ddf\u7740\u9898\u76ee\u8d70\u3002"),(0,l.kt)("h2",{id:"\u7cfb\u7edf\u8c03\u7528"},"\u7cfb\u7edf\u8c03\u7528"),(0,l.kt)("p",null,"\u7cfb\u7edf\u8c03\u7528\u7684\u6d41\u7a0b\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u8c03\u7528\u4e00\u4e2a\u5c01\u88c5\u597d\u7684\u7528\u6237\u7a7a\u95f4\u7684\u5e93\u51fd\u6570\uff08\u5982writef\uff09"),(0,l.kt)("li",{parentName:"ol"},"\u8c03\u7528\u7528\u6237\u7a7a\u95f4\u7684syscall_* \u51fd\u6570"),(0,l.kt)("li",{parentName:"ol"},"\u8c03\u7528msyscall\uff0c\u7528\u4e8e\u9677\u5165\u5185\u6838\u6001"),(0,l.kt)("li",{parentName:"ol"},"\u9677\u5165\u5185\u6838\uff0c\u5185\u6838\u53d6\u5f97\u4fe1\u606f\uff0c\u6267\u884c\u5bf9\u5e94\u7684\u5185\u6838\u7a7a\u95f4\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\uff08sys_*\uff09"),(0,l.kt)("li",{parentName:"ol"},"\u6267\u884c\u7cfb\u7edf\u8c03\u7528\uff0c\u5e76\u8fd4\u56de\u7528\u6237\u6001\uff0c\u540c\u65f6\u5c06\u8fd4\u56de\u503c\u201c\u4f20\u9012\u201d\u56de\u7528\u6237\u6001"),(0,l.kt)("li",{parentName:"ol"},"\u4ece\u5e93\u51fd\u6570\u8fd4\u56de\uff0c\u56de\u5230\u7528\u6237\u7a0b\u5e8f\u8c03\u7528\u5904")),(0,l.kt)("h3",{id:"exercise-41"},"Exercise 4.1"),(0,l.kt)("p",null,"\u586b\u5199user/syscall_wrap.S \u4e2d\u7684msyscall \u51fd\u6570\uff0c\u4f7f\u5f97\u7528\u6237\u90e8\u5206\u7684\u7cfb\u7edf\u8c03\u7528\u673a\u5236\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"LEAF(msyscall)\n    // TODO: you JUST need to execute a `syscall` instruction and return from msyscall\n    syscall\n    jr ra\n    nop\nEND(msyscall)\n")),(0,l.kt)("p",null,"\u6267\u884csyscall\u6307\u4ee4\uff0c\u7136\u540e\u4ece\u51fd\u6570\u8fd4\u56de\u3002"),(0,l.kt)("h3",{id:"thinking-41"},"Thinking 4.1"),(0,l.kt)("p",null,"\u601d\u8003\u5e76\u56de\u7b54\u4e0b\u9762\u7684\u95ee\u9898\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5185\u6838\u5728\u4fdd\u5b58\u73b0\u573a\u7684\u65f6\u5019\u662f\u5982\u4f55\u907f\u514d\u7834\u574f\u901a\u7528\u5bc4\u5b58\u5668\u7684\uff1f"),(0,l.kt)("li",{parentName:"ul"},"\u7cfb\u7edf\u9677\u5165\u5185\u6838\u8c03\u7528\u540e\u53ef\u4ee5\u76f4\u63a5\u4ece\u5f53\u65f6\u7684",(0,l.kt)("span",{parentName:"li",className:"math math-inline"},(0,l.kt)("span",{parentName:"span",className:"katex"},(0,l.kt)("span",{parentName:"span",className:"katex-mathml"},(0,l.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,l.kt)("semantics",{parentName:"math"},(0,l.kt)("mrow",{parentName:"semantics"},(0,l.kt)("mi",{parentName:"mrow"},"a"),(0,l.kt)("mn",{parentName:"mrow"},"0"),(0,l.kt)("mo",{parentName:"mrow"},"\u2212")),(0,l.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"a0-")))),(0,l.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,l.kt)("span",{parentName:"span",className:"base"},(0,l.kt)("span",{parentName:"span",className:"strut",style:{height:"0.72777em",verticalAlign:"-0.08333em"}}),(0,l.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,l.kt)("span",{parentName:"span",className:"mord"},"0"),(0,l.kt)("span",{parentName:"span",className:"mord"},"\u2212"))))),"a3 \u53c2\u6570\u5bc4\u5b58\u5668\u4e2d\u5f97\u5230\u7528\u6237\u8c03\u7528msyscall \u7559\u4e0b\u7684\u4fe1\u606f\u5417\uff1f"),(0,l.kt)("li",{parentName:"ul"},"\u6211\u4eec\u662f\u600e\u4e48\u505a\u5230\u8ba9sys \u5f00\u5934\u7684\u51fd\u6570\u201c\u8ba4\u4e3a\u201d\u6211\u4eec\u63d0\u4f9b\u4e86\u548c\u7528\u6237\u8c03\u7528msyscall \u65f6\u540c\u6837\u7684\u53c2\u6570\u7684\uff1f"),(0,l.kt)("li",{parentName:"ul"},"\u5185\u6838\u5904\u7406\u7cfb\u7edf\u8c03\u7528\u7684\u8fc7\u7a0b\u5bf9Trapframe \u505a\u4e86\u54ea\u4e9b\u66f4\u6539\uff1f\u8fd9\u79cd\u4fee\u6539\u5bf9\u5e94\u7684\u7528\u6237\u6001\u7684\u53d8\u5316\u662f\uff1f")),(0,l.kt)("h3",{id:"exercise-42"},"Exercise 4.2"),(0,l.kt)("p",null,"\u6309\u7167lib/syscall.S \u4e2d\u7684\u63d0\u793a\uff0c\u5b8c\u6210handle_sys \u51fd\u6570\uff0c\u4f7f\u5f97\u5185\u6838\u90e8\u5206\u7684\u7cfb\u7edf\u8c03\u7528\u673a\u5236\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002"),(0,l.kt)("p",null,"\u5728\u901a\u8fc7\u7279\u6743\u6307\u4ee4syscall \u9677\u5165\u5185\u6838\u6001\u540e\uff0c\u5904\u7406\u5668\u5c06PC \u5bc4\u5b58\u5668\u6307\u5411\u4e00\u4e2a\u76f8\u540c\u7684\u5185\u6838\u5f02\u5e38\u5165\u53e3\u3002\u5728trap_init \u51fd\u6570\u4e2d\u5c06\u7cfb\u7edf\u8c03\u7528\u7c7b\u578b\u7684\u5f02\u5e38\u7684\u5165\u53e3\u8bbe\u7f6e\u4e3a\u4e86handle_sys \u51fd\u6570\u3002"),(0,l.kt)("p",null,"\u7b2c\u4e00\u4e2aTODO\uff0cMIPS\u6709\u5f02\u5e38\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08exception program counter,EPC)\uff0c\u5c5e\u4e8eCP0\u5bc4\u5b58\u5668\uff0c\u7528\u4e8e\u4fdd\u5b58\u9020\u6210\u5f02\u5e38\u7684\u90a3\u6761\u6307\u4ee4\u7684\u5730\u5740\u3002\u8ba9EPC\u503c+4\u5230\u4e0b\u4e00\u6761\u6307\u4ee4\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u9677\u5165\u53cd\u590d\u4e2d\u65ad\u7684\u6b7b\u5faa\u73af\u4e4b\u4e2d\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"/*** exercise 4.2 ***/\nNESTED(handle_sys,TF_SIZE, sp)          // \u628a\u7528\u6237\u6001\u7684\u6240\u6709\u5bc4\u5b58\u5668\u5b58\u8fdb\u6808\u5e27\uff0csp\u76f8\u5f53\u4e8e\u6808\u9876\n    SAVE_ALL                            // \u7528\u4e8e\u4fdd\u5b58\u6240\u6709\u5bc4\u5b58\u5668\u7684\u6c47\u7f16\u5b8f\n    CLI                                 // \u7528\u4e8e\u5c4f\u853d\u4e2d\u65ad\u4f4d\u7684\u8bbe\u7f6e\u7684\u6c47\u7f16\u5b8f\n    nop\n    .set at                             // \u6062\u590d$at\u5bc4\u5b58\u5668\u7684\u4f7f\u7528\n\n    // TODO: Fetch EPC from Trapframe, calculate a proper value and store it back to trapframe.\n    lw      t0, TF_EPC(sp)              // \u5c06Trapframe\u7684EPC\u5bc4\u5b58\u5668\u53d6\u51fa\n    addu    t0, 4                       // \u8ba1\u7b97\u4e00\u4e2a\u5408\u7406\u7684\u503c\n    sw      t0, TF_EPC(sp)              // \u5b58\u56deTrapframe\u4e2d\n")),(0,l.kt)("p",null,"\u7b2c\u4e8c\u4e2aTODO\uff0c\u8fd9\u91cc\u5176\u5b9e\u662f\u591a\u4f59\u7684\uff0c\u56e0\u4e3aa0\u7684\u503c\u6ca1\u6709\u6539\u53d8\u8fc7\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"    // TODO: Copy the syscall number into $a0.\n    lw      a0, TF_REG4(sp)             // \u5c06\u7cfb\u7edf\u8c03\u7528\u53f7\u201c\u590d\u5236\u201d\u5165\u5bc4\u5b58\u5668$a0\uff0ca0\u662f4\u53f7\u5bc4\u5b58\u5668\n")),(0,l.kt)("p",null,"\u4e4b\u540e\u662f\u4fdd\u5b58\u5176\u4ed6\u7684\u503c\u5566\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"    addiu   a0, a0, -__SYSCALL_BASE     // a0 <- \u201c\u76f8\u5bf9\u201d\u7cfb\u7edf\u8c03\u7528\u53f7\n    sll     t0, a0, 2                   // t0 <- \u76f8\u5bf9\u7cfb\u7edf\u8c03\u7528\u53f7* 4\n    la      t1, sys_call_table          // t1 <- \u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u7684\u5165\u53e3\u8868\u57fa\u5730\u5740\n    addu    t1, t1, t0                  // t1 <- \u7279\u5b9a\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u5165\u53e3\u8868\u9879\u5730\u5740\n    lw      t2, 0(t1)                   // t2 <- \u7279\u5b9a\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u5165\u53e3\u51fd\u6570\u5730\u5740\n\n    lw      t0, TF_REG29(sp)            // t0 <- \u7528\u6237\u6001\u7684\u6808\u6307\u9488\n    lw      t3, 16(t0)                  // t3 <- msyscall\u7684\u7b2c5\u4e2a\u53c2\u6570\n    lw      t4, 20(t0)                  // t4 <- msyscall\u7684\u7b2c6\u4e2a\u53c2\u6570\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u6709\u4e00\u6b65\u8fd8\u539f\u504f\u79fb\u7684\u64cd\u4f5c\uff0c__SYSCALL_BASE\u7684\u5b9a\u4e49\u5728unistd.h\u91cc\u53ef\u4ee5\u770b\u5230\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"#ifndef UNISTD_H\n#define UNISTD_H\n\n#define __SYSCALL_BASE 9527\n#define __NR_SYSCALLS 20\n\n\n#define SYS_putchar         ((__SYSCALL_BASE ) + (0 ) )\n#define SYS_getenvid        ((__SYSCALL_BASE ) + (1 ) )\n#define SYS_yield           ((__SYSCALL_BASE ) + (2 ) )\n#define SYS_env_destroy     ((__SYSCALL_BASE ) + (3 ) )\n#define SYS_set_pgfault_handler ((__SYSCALL_BASE ) + (4 ) )\n#define SYS_mem_alloc       ((__SYSCALL_BASE ) + (5 ) )\n#define SYS_mem_map         ((__SYSCALL_BASE ) + (6 ) )\n#define SYS_mem_unmap       ((__SYSCALL_BASE ) + (7 ) )\n#define SYS_env_alloc       ((__SYSCALL_BASE ) + (8 ) )\n#define SYS_set_env_status  ((__SYSCALL_BASE ) + (9 ) )\n#define SYS_set_trapframe       ((__SYSCALL_BASE ) + (10 ) )\n#define SYS_panic           ((__SYSCALL_BASE ) + (11 ) )\n#define SYS_ipc_can_send        ((__SYSCALL_BASE ) + (12 ) )\n#define SYS_ipc_recv        ((__SYSCALL_BASE ) + (13 ) )\n#define SYS_cgetc           ((__SYSCALL_BASE ) + (14 ) )\n#endif\n")),(0,l.kt)("p",null,"\u7b2c\u4e09\u4e2aTODO\uff0c\u548cMIPS\u7684\u4f20\u53c2\u6709\u5173\uff0c\u524d4 \u4e2a\u53c2\u6570\u4f1a\u88absyscall \u5f00\u5934\u7684\u51fd\u6570\u5206\u522b\u5b58\u5165a0\u2212a3\uff08$4~$7\uff09 \u5bc4\u5b58\u5668\u7684\u7a7a\u95f4\u5185\uff0c\u540c\u65f6\u6808\u5e27\u5e95\u90e8\u4fdd\u755916 \u5b57\u8282\u7684\u7a7a\u95f4\uff1b\u540e2\u4e2a\u53c2\u6570\u53ea\u4f1a\u88ab\u5b58\u5165\u5728\u524d4\u7684\u53c2\u6570\u7684\u9884\u7559\u7a7a\u95f4\u4e4b\u4e0a\u76848\u5b57\u8282\u7a7a\u95f4\u5185\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"    // TODO: Allocate a space of six arguments on current kernel stack and copy the six arguments to proper location\n    lw      a0, TF_REG4(sp)             // \u8fd9\u4e00\u6b65\u4e5f\u662f\u591a\u4f59\u7684\n    lw      a1, TF_REG5(sp)\n    lw      a2, TF_REG6(sp)\n    lw      a3, TF_REG7(sp)\n    subu    sp, sp, 24\n    sw      t3, 16(sp)                  // 0-16\uff1a\u6808\u5e27\u5e95\u90e8\u4fdd\u7559\u768416\u5b57\u8282\u7a7a\u95f4\n    sw      t4, 20(sp)\n    \n    jalr    t2                          // \u8c03\u7528sys_*\u51fd\u6570\n    nop\n")),(0,l.kt)("p",null,"\u7b2c\u56db\u4e2aTODO\uff0c\u6062\u590dsp\u6307\u9488\u7684\u503c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"    // TODO: Resume current kernel stack\n    addiu   sp, sp, 24                  // \u6062\u590d\u6808\u6307\u9488\u5230\u5206\u914d\u524d\u7684\u72b6\u6001\n    \n\n    sw      v0, TF_REG2(sp)             // \u6b64\u65f6\u5df2\u7ecf\u4ece\u7cfb\u7edf\u8c03\u7528\u4e2d\u8fd4\u56de\uff0c\u5c06\u8fd4\u56de\u503c\u5b58\u5165Trapframe\n\n    j       ret_from_exception          // \u4ece\u5f02\u5e38\u4e2d\u8fd4\u56de\uff08\u6062\u590d\u73b0\u573a\uff09\n    nop\nEND(handle_sys)\n")),(0,l.kt)("p",null,"\u6700\u540e\u5c31\u5c06\u8fd4\u56de\u503c\u4fdd\u5b58\u5230v0\uff0c\u540c\u65f6\u4ece\u7cfb\u7edf\u8c03\u7528\u4e2d\u8fd4\u56de\u4e86\u3002"),(0,l.kt)("h3",{id:"exercise-43"},"Exercise 4.3"),(0,l.kt)("p",null,"\u5b9e\u73b0lib/syscall_all.c \u4e2d\u7684int sys_mem_alloc(int sysno,u_int envid,u_int va, u_int perm) \u51fd\u6570\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"/* \u6982\u8ff0:\n * \u5206\u914d\u4e00\u9875\u5185\u5b58\uff0c\u5e76\u6620\u5c04\u5230'va'\u7684\u6743\u9650\n * 'envid'\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\u7684'perm'\u3002\n * \u5982\u679c\u4e00\u4e2a\u9875\u9762\u5df2\u7ecf\u5728'va'\u88ab\u6620\u5c04\uff0c\u90a3\u4e48\u8be5\u9875\u9762\u5c06\u88ab\u53d6\u6d88\u6620\u5c04\u3002\n * \u524d\u63d0:\n * perm\uff1a\u9700\u8981PTE_V\uff0c\u4e0d\u5141\u8bb8\u4f7f\u7528PTE_COW(\u8fd4\u56de-E_INVAL)\uff0c\n * \u5176\u4ed6\u4f4d\u662f\u53ef\u9009\u7684\u3002\n *\n * \u540e\u7f6e\u6761\u4ef6:\n * \u6210\u529f\u8fd4\u56de0\uff0c\u9519\u8bef< 0\n * va\u5fc5\u987b < UTOP\n * env\u53ef\u4ee5\u4fee\u6539\u81ea\u5df1\u7684\u5730\u5740\u7a7a\u95f4\u6216\u5176\u5b50\u8282\u70b9\u7684\u5730\u5740\u7a7a\u95f4\n * /\n/*** exercise 4.3 ***/\nint sys_mem_alloc(int sysno, u_int envid, u_int va, u_int perm)\n{\n    // Your code here.\n    struct Env *env;\n    struct Page *ppage;\n    int ret;\n    ret = 0;\n\n    // 2020-04-28\n    if (va >= UTOP || (perm & PTE_COW) || !(perm & PTE_V))  // PTE_V may?\n        return -E_INVAL;\n\n    ret = envid2env(envid, &env, 0);\n    if (ret < 0)\n        return ret;\n\n    ret = page_alloc(&ppage);\n    if (ret < 0)\n        return ret;\n\n    ret = page_insert(env->env_pgdir, ppage, va, perm);\n    if (ret < 0)\n        return ret;\n\n    return 0;\n}\n")),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"\u8fd9\u662f\u4e00\u7bc7\u4eceHexo\u8fc1\u79fb\u7684\u6587\u7ae0\uff0c\u521b\u5efa\u4e8e2020-05-05 18:22:36"))))}u.isMDXComponent=!0}}]);