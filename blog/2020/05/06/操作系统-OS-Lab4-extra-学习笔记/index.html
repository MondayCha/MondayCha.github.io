<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="L1l RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="L1l Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">操作系统 OS Lab4-extra 学习笔记 | L1l</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://mondaycha.github.io/blog/2020/05/06/操作系统-OS-Lab4-extra-学习笔记"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="操作系统 OS Lab4-extra 学习笔记 | L1l"><meta data-react-helmet="true" name="description" content="Extra，干巴爹。"><meta data-react-helmet="true" property="og:description" content="Extra，干巴爹。"><meta data-react-helmet="true" name="keywords" content="学习"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2020-05-06T18:22:36.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/MondayCha"><meta data-react-helmet="true" property="article:tag" content="OS,学习笔记"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://mondaycha.github.io/blog/2020/05/06/操作系统-OS-Lab4-extra-学习笔记"><link data-react-helmet="true" rel="alternate" href="https://mondaycha.github.io/blog/2020/05/06/操作系统-OS-Lab4-extra-学习笔记" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mondaycha.github.io/blog/2020/05/06/操作系统-OS-Lab4-extra-学习笔记" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.67d8d4ca.css">
<link rel="preload" href="/assets/js/runtime~main.5f76f6a2.js" as="script">
<link rel="preload" href="/assets/js/main.ac56a076.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="MondayCha" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="MondayCha" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">L1l</b></a><a class="navbar__item navbar__link" href="/">随笔</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">日常</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/MondayCha" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">全部博文</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/04/Windows-10-安装-Ubuntu-20.04-双系统不完全踩坑记录">Windows 10 安装 Ubuntu 20.04 双系统不完全踩坑记录</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/19/『DP』房间传送门问题">『DP』房间传送门问题</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/12/字节跳动-客户端研发实习生-二面面经">字节跳动 客户端研发实习生 二面面经</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/11/简陋的Java生产者消费者模型">简陋的Java生产者消费者模型</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/10/排序算法学习笔记">排序算法学习笔记</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/09/字节跳动-客户端研发实习生-一面面经">字节跳动 客户端研发实习生 一面面经</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/06/LeetCode「830」-较大分组的位置">LeetCode「830」 较大分组的位置</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/04/LeetCode「509」-斐波那契数">LeetCode「509」 斐波那契数</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/03/LeetCode「86」-分隔链表">LeetCode「86」 分隔链表</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/02/LeetCode「239」-滑动窗口最大值">LeetCode「239」 滑动窗口最大值</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/13/基于Vue的手办百科与交易平台">基于Vue的手办百科与交易平台</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/04/LeetCode「659」-分割数组为连续子序列">LeetCode「659」 分割数组为连续子序列</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/11/30/LeetCode「767」-重构字符串">LeetCode「767」 重构字符串</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/11/01/我的-第一个-Vue练手项目">我的 第一个 Vue练手项目</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/06/15/2020-OO-第四单元总结">2020 OO 第四单元总结</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/06/03/马原探讨：垄断产生消除了竞争？">马原探讨：垄断产生消除了竞争？</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/30/《共产党宣言》带给我的两点疑惑">《共产党宣言》带给我的两点疑惑</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/24/操作系统-OS-Lab5-实验笔记">操作系统 OS Lab5 实验笔记</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/21/2020-OO-JML语言理论基础与工具链总结">2020 OO JML语言理论基础与工具链总结</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/20/对马克思《哲学的贫困》的理解">对马克思《哲学的贫困》的理解</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/11/操作系统-OS-Lab4-实验报告">操作系统 OS Lab4 实验报告</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/08/《航空航天概论》Week10">《航空航天概论》Week10</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/06/谈谈对《关于费尔巴哈的提纲》第三条的理解">谈谈对《关于费尔巴哈的提纲》第三条的理解</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2020/05/06/操作系统-OS-Lab4-extra-学习笔记">操作系统 OS Lab4-extra 学习笔记</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/05/操作系统-OS-Lab4-学习笔记">操作系统 OS Lab4 学习笔记</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/01/《航空航天概论》Week9">《航空航天概论》Week9</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/24/操作系统-OS-Lab3-实验报告">操作系统 OS Lab3 实验报告</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/24/操作系统-OS-Lab3-学习笔记">操作系统 OS Lab3 学习笔记</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/23/《航空航天概论》Week8">《航空航天概论》Week8</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/16/《航空航天概论》Week7">《航空航天概论》Week7</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/16/冯如杯创业大赛-风险投资部分">冯如杯创业大赛-风险投资部分</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/16/冯如杯创业大赛第一次修改意见">冯如杯创业大赛第一次修改意见</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/09/2020-OO-第二单元总结">2020 OO 第二单元总结</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/09/《航空航天概论》Week6">《航空航天概论》Week6</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/04/操作系统-OS-Lab2-实验报告">操作系统 OS Lab2 实验报告</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/04/02/《航空航天概论》Week5">《航空航天概论》Week5</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/31/Shields-测试">Shields 测试</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/30/操作系统-OS-Lab2-学习笔记-「Part-2」">操作系统 OS Lab2 学习笔记 「Part 2」</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/26/操作系统-OS-第五次作业">操作系统 OS 第五次作业</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/24/操作系统-OS-Lab2-学习笔记-「Part-1」">操作系统 OS Lab2 学习笔记 「Part 1」</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/24/如何使用Git从远程仓库获取所有分支">如何使用Git从远程仓库获取所有分支</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/21/操作系统-OS-Lab1-实验报告">操作系统 OS Lab1 实验报告</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/21/《航空航天概论》Week4">《航空航天概论》Week4</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/20/OO-第一单元总结-表达式求导">OO 第一单元总结 表达式求导</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/19/《航空航天概论》Week3">《航空航天概论》Week3</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/09/《航空航天概论》Week2">《航空航天概论》Week2</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/06/操作系统-OS-Lab0-实验报告">操作系统 OS Lab0 实验报告</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/05/Java求解一类特定表达式的化简思路探讨">Java求解一类特定表达式的化简思路探讨</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/02/操作系统-OS-Lab0">操作系统 OS Lab0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/03/02/面向过程的设计，和面向对象的设计异同点到底在哪？">面向过程的设计，和面向对象的设计异同点到底在哪？</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/24/《一堂好课》观后感">《一堂好课》观后感</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/24/对马克思主义的理解">对马克思主义的理解</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/14/OO预习第三弹">OO预习第三弹</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/10/为圣杯战争的开始献上礼炮">为圣杯战争的开始献上礼炮</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/09/Git-Day3">Git-Day3</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/09/『ePub资源』有时间谈恋爱不如去抽卡！02">『ePub资源』有时间谈恋爱不如去抽卡！02</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/08/Git-Day2">Git-Day2</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/07/Git-Day1">Git-Day1</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/03/『ePub资源』有时间谈恋爱不如去抽卡！01">『ePub资源』有时间谈恋爱不如去抽卡！01</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/02/第一篇文章！">第一篇文章！</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">操作系统 OS Lab4-extra 学习笔记</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2020-05-06T18:22:36.000Z" itemprop="datePublished">May 6, 2020</time></div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/MondayCha" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/MondayCha.png" alt="L1l"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/MondayCha" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">L1l</span></a></div><small class="avatar__subtitle" itemprop="description">我逐渐理解了一切（完全没理解）</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><header><h1>Lab4-extra 学习笔记</h1></header><p>Extra，干巴爹。</p><p>（5/9，刚刚才知道今年的Extra基础是去年的Exam1，我biss……）</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="基础测试1">基础测试1<a aria-hidden="true" class="hash-link" href="#基础测试1" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="题目要求">题目要求<a aria-hidden="true" class="hash-link" href="#题目要求" title="Direct link to heading">​</a></h3><p>实现可变参数的系统调用参数传递。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="题目解析">题目解析<a aria-hidden="true" class="hash-link" href="#题目解析" title="Direct link to heading">​</a></h3><p>之前提到过，syscall 开头的函数与内核中的系统调用函数（sys 开头的函数）是一一对应的。调用过程如下：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">syscall_mem_map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">u_int srcid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> u_int srcva</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> u_int dstid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> u_int dstva</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> u_int perm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">msyscall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SYS_mem_map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> srcid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> srcva</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dstid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dstva</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> perm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>所以现在就要指定参数数目，在原有lib/syscall_all.c中代码不更改的情况下可以使系统调用机制正常运行。</p><p>指导书提示我们学习printf的实现方式，下面就来看看。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="printf">Printf<a aria-hidden="true" class="hash-link" href="#printf" title="Direct link to heading">​</a></h3><p>首先是lib/printf.c中的实现：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">fmt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// printf有一个固定参数fmt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        va_list ap</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                     </span><span class="token comment" style="color:#999988;font-style:italic">// 定义了一个指针ap, 用于指示可选的参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">va_start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">// 以固定参数的地址为起点，确定变参的内存起始地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">lp_Print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myoutput</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ap</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 将printf的va_list传递给lp_Print</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">va_end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ap</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                     </span><span class="token comment" style="color:#999988;font-style:italic">// 清空参数列表, 并置参数指针ap无效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>除了有一个参数fmt固定以外，后面跟的参数的个数和类型是可变的（用三个点“…”做参数占位符）。这里我们实际上是将printf的可变长参数直接传递给lp_Print，后者在在Lab1实现过，也比较复杂。关于那几个宏定义的作用，参考这里的解释：</p><blockquote><p>（1）va_list
　　定义了一个指针arg_ptr, 用于指示可选的参数.</p><p>（2）va_start(arg_ptr, argN)
　使参数列表指针arg_ptr指向函数参数列表中的第一个可选参数，argN是位于第一个可选参数之前的固定参数, 或者说最后一个固定参数.如有一va函数的声明是void va_test(char a, char b, char c, ...), 则它的固定参数依次是a,b,c, 最后一个固定参数argN为c, 因此就是va_start(arg_ptr, c).</p><p>（3）va_arg(arg_ptr, type)
返回参数列表中指针arg_ptr所指的参数, 返回类型为type. 并使指针arg_ptr指向参数列表中下一个参数.返回的是可选参数, 不包括固定参数.</p><p>（4）va_end(arg_ptr)
清空参数列表, 并置参数指针arg_ptr无效.</p><p>  （注：va在这里是variable-argument(可变参数)的意思.  这些宏定义在stdarg.h中,所以用到可变参数的程序应该包含这个头文件）</p></blockquote><p>以上知识均在基础中没有用。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="具体实现">具体实现<a aria-hidden="true" class="hash-link" href="#具体实现" title="Direct link to heading">​</a></h3><p>首先修改user/lib.h中的msyscall函数声明：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//////////////////////////////////////////////////syscall_lib</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">extern</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">msyscall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>C语言调用汇编函数，用extern关键字定义。在syscall_* 系列函数中，我们将参数传递给了msyscall 函数。</p><p>在MIPS 的调用规范中，进入函数体时会通过对栈指针做减法的方式为自身的局部变量、返回地址、调用函数的参数分配存储空间（叶函数没有后两者），在函数调用结束之后会对栈指针做加法来释放这部分空间，我们把这部分空间称为栈帧（Stack Frame）。非叶函数是在调用方的栈帧的底部预留被调用函数的参数存储空间（被调用方从调用方函数的栈帧中取得参数）。</p><p>msyscall叶函数没有局部变量，不需要分配栈帧，我们只需要执行特权指令（syscall）来陷入内核态以及函数调用返回即可。在通过特权指令syscall 陷入内核态后，处理器将PC 寄存器指向一个相同的内核异常入口。在trap_init 函数中将系统调用类型的异常的入口设置为了handle_sys 函数，这就是我们要修改的第二个地方：修改lib/syscall.S，增加拷贝多个参数的循环。</p><blockquote><p>TIPS：汇编内的跳转注意延迟槽，内核态参数拷贝时注意使用s0-s7保存栈空间</p></blockquote><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">NESTED</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handle_sys</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">TF_SIZE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SAVE_ALL                            </span><span class="token comment" style="color:#999988;font-style:italic">// 用于保存所有寄存器的汇编宏</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CLI                                 </span><span class="token comment" style="color:#999988;font-style:italic">// 用于屏蔽中断位的设置的汇编宏</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set at                             </span><span class="token comment" style="color:#999988;font-style:italic">// 恢复$at寄存器的使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw      t0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TF_EPC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">// 将Trapframe的EPC寄存器取出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addu    t0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic">// 计算一个合理的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sw      t0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TF_EPC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">// 存回Trapframe中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw      a0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TF_REG4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// 将系统调用号“复制”入寄存器$a0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   a0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">__SYSCALL_BASE     </span><span class="token comment" style="color:#999988;font-style:italic">// a0 &lt;- “相对”系统调用号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sll     t0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// t0 &lt;- 相对系统调用号* 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    la      t1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sys_call_table          </span><span class="token comment" style="color:#999988;font-style:italic">// t1 &lt;- 系统调用函数的入口表基地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addu    t1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t0                  </span><span class="token comment" style="color:#999988;font-style:italic">// t1 &lt;- 特定系统调用函数入口表项地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw      t2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// t2 &lt;- 特定系统调用函数入口函数地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw      t0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TF_REG29</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// t0 &lt;- 用户态的栈指针</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* lw      t3, 16(t0)                  // t3 &lt;- msyscall的第5个参数 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* lw      t4, 20(t0)                  // t4 &lt;- msyscall的第6个参数 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Allocate a space of six arguments on current kernel stack and copy the six arguments to proper location</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw      a0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TF_REG4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw      a1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TF_REG5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    li      s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic">// 当前参数个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    beq     s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labelend            </span><span class="token comment" style="color:#999988;font-style:italic">// if s0 == a1 then target</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw      a2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TF_REG6</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// s0 = 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    beq     s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labelend            </span><span class="token comment" style="color:#999988;font-style:italic">// if s0 == a1 then target</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw      a3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TF_REG7</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// s0 = 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    li      s1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">                      </span><span class="token comment" style="color:#999988;font-style:italic">// 当前栈高度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fori</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    beq     s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> beforej             </span><span class="token comment" style="color:#999988;font-style:italic">// if s0 == a1 then target</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// s0 = s0 + 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   s1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// s1 = s1 + 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    j       fori</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beforej</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subu    sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s1                  </span><span class="token comment" style="color:#999988;font-style:italic">// sp = sp - s1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    li      s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic">// 当前已保存的参数个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   s2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">// tf寄存器偏移量，每次步进4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   s3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">// sp寄存器偏移量，每次步进4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">forj</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    beq     s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labelend            </span><span class="token comment" style="color:#999988;font-style:italic">// if s0 == a1 then target</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw      t3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// t3 &lt;- msyscall的第((s2 - t0) / 4 + 1)个参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sw      t3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// s0 = s0 + 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   s2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   s3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    j       forj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">labelend</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jalr    t2                          </span><span class="token comment" style="color:#999988;font-style:italic">// Invoke sys_* function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Resume current kernel stack</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addiu   sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sw      v0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TF_REG2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// Store return value of function sys_* (in $v0) into trapframe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    j       ret_from_exception          </span><span class="token comment" style="color:#999988;font-style:italic">// Return from exeception</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handle_sys</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><header><h1>PB,YYDS</h1></header></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/os">OS</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/学习笔记">学习笔记</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/edit/main/website/blog/blog/2020-05-06-操作系统-OS-Lab4-extra-学习笔记.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/05/06/谈谈对《关于费尔巴哈的提纲》第三条的理解"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« <!-- -->谈谈对《关于费尔巴哈的提纲》第三条的理解</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/05/05/操作系统-OS-Lab4-学习笔记"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">操作系统 OS Lab4 学习笔记<!-- --> »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基础测试1" class="table-of-contents__link toc-highlight">基础测试1</a><ul><li><a href="#题目要求" class="table-of-contents__link toc-highlight">题目要求</a></li><li><a href="#题目解析" class="table-of-contents__link toc-highlight">题目解析</a></li><li><a href="#printf" class="table-of-contents__link toc-highlight">Printf</a></li><li><a href="#具体实现" class="table-of-contents__link toc-highlight">具体实现</a></li></ul></li></ul></div></div></div></div></div></div>
<script src="/assets/js/runtime~main.5f76f6a2.js"></script>
<script src="/assets/js/main.ac56a076.js"></script>
</body>
</html>