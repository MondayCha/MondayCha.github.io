<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="L1l RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="L1l Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">2020 OO JML语言理论基础与工具链总结 | L1l</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://mondaycha.github.io/BUAA/课程/面向对象设计与构造/OO-JML语言理论基础与工具链总结"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="2020 OO JML语言理论基础与工具链总结 | L1l"><meta data-react-helmet="true" name="description" content="第三单元终于结束了，这是我目前为止最惨的一单元，第十次作业强测20分，互测杀成狗……虽然都知道只关注分数没有什么意义，我更应该去体会的是通过JML学习对于程序设计理念的认知，但是……心真的很痛。"><meta data-react-helmet="true" property="og:description" content="第三单元终于结束了，这是我目前为止最惨的一单元，第十次作业强测20分，互测杀成狗……虽然都知道只关注分数没有什么意义，我更应该去体会的是通过JML学习对于程序设计理念的认知，但是……心真的很痛。"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://mondaycha.github.io/BUAA/课程/面向对象设计与构造/OO-JML语言理论基础与工具链总结"><link data-react-helmet="true" rel="alternate" href="https://mondaycha.github.io/BUAA/课程/面向对象设计与构造/OO-JML语言理论基础与工具链总结" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mondaycha.github.io/BUAA/课程/面向对象设计与构造/OO-JML语言理论基础与工具链总结" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.67d8d4ca.css">
<link rel="preload" href="/assets/js/runtime~main.8b4ddefc.js" as="script">
<link rel="preload" href="/assets/js/main.5eda9060.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="MondayCha" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="MondayCha" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">L1l</b></a><a class="navbar__item navbar__link navbar__link--active" href="/">随笔</a><a class="navbar__item navbar__link" href="/blog">日常</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/MondayCha" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">主页</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">BUAA</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/BUAA/个人德育情况总结">个人德育情况总结</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">毕业设计</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">课程</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">操作系统实验</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">航空航天概论</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">软件工程</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">面向对象设计与构造</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/BUAA/课程/面向对象设计与构造/OO-JML语言理论基础与工具链总结">2020 OO JML语言理论基础与工具链总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/BUAA/课程/面向对象设计与构造/OO-第二单元总结">2020 OO 第二单元总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/BUAA/课程/面向对象设计与构造/OO-第四单元总结">2020 OO 第四单元总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/BUAA/课程/面向对象设计与构造/Java求解一类特定表达式的化简思路探讨">Java求解一类特定表达式的化简思路探讨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/BUAA/课程/面向对象设计与构造/OO-第一单元总结-表达式求导">OO 第一单元总结 表达式求导</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/BUAA/课程/面向对象设计与构造/OO预习第三弹">OO预习第三弹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/BUAA/课程/面向对象设计与构造/为圣杯战争的开始献上礼炮">为圣杯战争的开始献上礼炮</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/BUAA/课程/面向对象设计与构造/简陋的Java生产者消费者模型">简陋的Java生产者消费者模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/BUAA/课程/面向对象设计与构造/面向过程的设计，和面向对象的设计异同点到底在哪？">面向过程的设计，和面向对象的设计异同点到底在哪？</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">马克思主义原理</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Software</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Leetcode</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ACGN</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Template</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>2020 OO JML语言理论基础与工具链总结</h1></header><p>第三单元终于结束了，这是我目前为止最惨的一单元，第十次作业强测20分，互测杀成狗……虽然都知道只关注分数没有什么意义，我更应该去体会的是通过JML学习对于程序设计理念的认知，但是……心真的很痛。</p><p>下面就进入单元总结：</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="1-jml语言理论基础与工具链">1. JML语言理论基础与工具链<a aria-hidden="true" class="hash-link" href="#1-jml语言理论基础与工具链" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="11-jml语言是什么">1.1 JML语言是什么<a aria-hidden="true" class="hash-link" href="#11-jml语言是什么" title="Direct link to heading">​</a></h3><p>参考课程组下发的《JML(Level 0)使用手册》，JML语言的定义如下：</p><blockquote><p>JML(Java Modeling Language)是用于对Java程序进行规格化设计的一种表示语言。JML是一种行为接口规格语言（Behavior Interface Specification Language，BISL），基于Larch方法构建。</p></blockquote><p>也就是说，JML是一种对代码语言的抽象——不同的语言有着不同的语法，而JML通过自己的规则对代码进行了形式化的表述，一旦规格确定，除非涉及复杂的算法要求，实现代码就变成了一个相对简单的事情。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="12-jml语言基本语法">1.2 JML语言基本语法<a aria-hidden="true" class="hash-link" href="#12-jml语言基本语法" title="Direct link to heading">​</a></h3><p>JML的核心在于用表达式对规格进行描述，首先从常见的表达式说起，给人的感觉类似离散数学：</p><table><thead><tr><th>表达式</th><th>含义</th></tr></thead><tbody><tr><td>\result</td><td>方法的返回值（非void类型）</td></tr><tr><td>\old(expr)</td><td>表达式expr在方法执行前的取值</td></tr><tr><td>\not_assigned(x, y, ...)</td><td>括号中的变量是否在方法执行过程中未被赋值</td></tr><tr><td>\not_modified(x, y, ...)</td><td>限制括号中的变量在方法执行期间的取值未发生变化</td></tr><tr><td>\forall</td><td>全称量词</td></tr><tr><td>\exists</td><td>存在量词</td></tr><tr><td>\sum</td><td>返回给定范围内的表达式的和</td></tr><tr><td>\product</td><td>返回给定范围内的表达式的连乘结果</td></tr><tr><td>\max</td><td>返回给定范围内的表达式的最大值</td></tr><tr><td>\min</td><td>返回给定范围内的表达式的最小值</td></tr><tr><td>\num_of</td><td>返回指定变量中满足相应条件的取值个数</td></tr><tr><td>&lt;:</td><td>子类型关系操作符</td></tr><tr><td>&lt;==&gt;</td><td>等价关系操作符</td></tr><tr><td>==&gt;</td><td>推理操作符</td></tr><tr><td>\everything</td><td>全集</td></tr><tr><td>\nothing</td><td>空集</td></tr></tbody></table><p>表达式中容易错的地方在于\old(<code>expr</code>)表达式，作为一般规则，任何情况下，都应该使用\old把关心的表达式取值整体括起来。</p><table><thead><tr><th>方法规格</th><th>含义</th></tr></thead><tbody><tr><td>requires</td><td>表达的意思是“要求调用者确保P为真”</td></tr><tr><td>ensures</td><td>表达的意思是“方法实现者确保方法执行返回结果一定满足谓词P的要求，即确保P为真”</td></tr><tr><td>assignable/modifiable</td><td>副作用范围限定，副作用指方法在执行过程中会修改对象的属性数据或者类的静态成员数据，从而给后续方法的执行带来影响。<code>assignble</code>表示可赋值，而<code>modifiable</code>则表示可修改</td></tr><tr><td>pure</td><td>纯粹访问性的方法，不会对对象的状态进行任何改变，也不需要提供输入参数</td></tr><tr><td>public normal_behavior</td><td>正常功能，一般指输入或方法关联this对象的状态在正常范围内时所指向的功能。</td></tr><tr><td>public exceptional_behavior</td><td>与正常功能相对</td></tr><tr><td>signals</td><td>结构为<code>signals (***Exception e) b_expr;</code>，意思是当<code>b_expr</code>为<code>true</code>时，方法会抛出括号中给出的相应异常<code>e</code></td></tr></tbody></table><p>最后是类型规格，指针对类或接口所设计的约束规则。</p><table><thead><tr><th>类型规格</th><th>含义</th></tr></thead><tbody><tr><td>invariant</td><td>不变式，只针对可见状态(即当下可见状态)的取值进行约束</td></tr><tr><td>constraint</td><td>状态变化约束，对前序可见状态和当前可见状态的关系进行约束</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_31ik" id="13-应用工具链情况">1.3 应用工具链情况<a aria-hidden="true" class="hash-link" href="#13-应用工具链情况" title="Direct link to heading">​</a></h3><p>在网络上查找JML工具链，搜索到的大多是OO博客的内容。工具主要包括OpenJML、JMLUnitNG等。</p><ul><li>OpenJML: <a href="http://www.openjml.org/" target="_blank" rel="noopener noreferrer">http://www.openjml.org/</a></li><li>JMLUnitNG: <a href="http://insttech.secretninjaformalmethods.org/software/jmlunitng/" target="_blank" rel="noopener noreferrer">http://insttech.secretninjaformalmethods.org/software/jmlunitng/</a></li></ul><p>在编写三次作业时，我用的java版本是JDK13，无法使用相关工具链，于是也在作业中并没有使用；撰写本次博客时重新安装了JRE1.8，具体使用在下面的部分描述。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="2-smt-solver验证">2. SMT Solver验证<a aria-hidden="true" class="hash-link" href="#2-smt-solver验证" title="Direct link to heading">​</a></h2><p>参考了J哥的教程（<a href="https://www.cnblogs.com/pekopekopeko/p/12920417.html#4581709%EF%BC%89%EF%BC%8C%E8%BF%9B%E8%A1%8COpenJML%E7%9A%84%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6SMT" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/pekopekopeko/p/12920417.html#4581709），进行OpenJML的基础组件SMT</a> Solver验证，文件树如下：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">PS G:\STUDY\BUAA-2020-OO\Week12&gt; tree /F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">卷 办公 的文件夹 PATH 列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">卷序列号为 AA85-2D30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">G:.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Group.java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Person.java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─openjml-0.8.44-20200413</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │  epl-v10.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │  jml-reference-manual.pdf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │  jmlruntime.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │  jmlspecs.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │  LICENSE.rtf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │  openjml-template.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │  openjml.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │  OpenJMLUserGuide.pdf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │  VERSION_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─Solvers-linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │      cvc4-1.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │      z3-4.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │      z3-4.3.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │      z3-4.7.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─Solvers-macos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │      cvc4-1.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │      z3-4.3.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │      z3-4.5.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │      z3-4.6.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │      z3-4.7.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └─Solvers-windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cvc4-1.6.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            z3-4.3.2.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            z3-4.7.1.exe</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>先运行静态验证指令：<code>java -jar .\openjml.jar -exec .\Solvers-windows\z3-4.7.1.exe -esc ..\Group.java</code>，得到初步结果：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class Person {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..\Group.java:34: 警告: A non-pure method is being called where it is not permitted: Person.isLinked(Person)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @          (\sum int j; 0 &lt;= j &amp;&amp; j &lt; people.length &amp;&amp; people[i].isLinked(people[j]); 1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                               ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..\Group.java:40: 警告: A non-pure method is being called where it is not permitted: Person.isLinked(Person)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @           people[i].isLinked(people[j]); people[i].queryValue(people[j])));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..\Group.java:40: 警告: A non-pure method is being called where it is not permitted: Person.queryValue(Person)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..\Group.java:47: 警告: A non-pure method is being called where it is not permitted: Person.getCharacter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @          temp.length == people.length &amp;&amp; temp[0] == people[0].getCharacter();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                  ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..\Group.java:49: 警告: A non-pure method is being called where it is not permitted: Person.getCharacter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @            temp[i] == temp[i-1].xor(people[i].getCharacter())) &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                  ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..\Group.java:59: 警告: A non-pure method is being called where it is not permitted: Person.getAge()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                            ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..\Group.java:58: 错误: 不可比较的类型: int和INT#1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /*@ ensures \result == (people.length == 0? 0 :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  其中, INT#1是交叉类型:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INT#1扩展Number,Comparable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @          (people[i].getAge() - getAgeMean()) * (people[i].getAge() - getAgeMean())) /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..\Group.java:64: 警告: A non-pure method is being called where it is not permitted: Person.getAge()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @          (people[i].getAge() - getAgeMean()) * (people[i].getAge() - getAgeMean())) /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                        ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..\Group.java:63: 错误: 不可比较的类型: int和INT#1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  其中, INT#1是交叉类型:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INT#1扩展Number,Comparable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 个错误</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 个警告</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>报错和警告主要有两种，在不允许的地方调用非纯方法，以及不可比较的类型（貌似是不能识别三目运算符？），动态验证的信息就更多了。</p><p>总之我感觉看着结果云里雾里的，SMT Solver目前好像也无法对exist等进行验证，不过作者一直在更新，相信下一届的同学们可以享受到更加舒适的SMT Solver的！</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="3-jmlunitngjmlunit自动生成测试用例">3. JMLUnitNG/JMLUnit自动生成测试用例<a aria-hidden="true" class="hash-link" href="#3-jmlunitngjmlunit自动生成测试用例" title="Direct link to heading">​</a></h2><p>辛辛苦苦以10KB/S的速度下载下来，一运行傻了——</p><p>到百度求助，表示版本太低，然而我已经下载了官网最新的1.8版本……另外发现这中间似乎插了句人话：<code>错误: 非法的类型开始 value = new ArrayList&lt;&gt;();</code>，感情必须要写成<code>value = new ArrayList&lt;Integer&gt;();</code>的形式？这也太OUT了吧……</p><p>之后又出现了群里提到的神秘的++，触发了<code>JmlInternalError</code>,更加迷惑了。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">org.jmlspecs.openjml.JmlInternalError: The operation symbol ++ for type java.lang.Object could not be resolved</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="简要分析">简要分析<a aria-hidden="true" class="hash-link" href="#简要分析" title="Direct link to heading">​</a></h4><p>最后我折腾了很久还是不行……运行完什么结果也没有……我也很疑惑为什么运行SMT Solver时就相对顺风顺水但JMLUnitNG怎么整都不行（对帮我找问题的PB同学深表歉意）。因为我的电脑不能生成，所以就看了很多同学的博客，这里借用@VOIDMalkuth的测试结果：</p><p>从同学们的结果来看，JMLUnitNG自动生成的样例可以检测到一定的错误，对于INT数据测试了极端情况等与实际应用不符合的数据输入，要成为真正有用的工具，还有很长的路要走……</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="4-架构设计梳理与模型构建策略分析">4. 架构设计梳理与模型构建策略分析<a aria-hidden="true" class="hash-link" href="#4-架构设计梳理与模型构建策略分析" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="41-第九次作业">4.1 第九次作业<a aria-hidden="true" class="hash-link" href="#41-第九次作业" title="Direct link to heading">​</a></h3><p>UML类图如下：</p><p>本次作业只要对着规格就能完成大部分任务，架构上使用的MyPerson、MyNetwork均继承课程组所给的接口。</p><p>需要考虑算法实现的是isCircle，我采用了BFS广度优先搜索，从每个Person内调出邻接表搜索，复杂度为O(N+E)。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="42-第十次作业">4.2 第十次作业<a aria-hidden="true" class="hash-link" href="#42-第十次作业" title="Direct link to heading">​</a></h3><p>UML类图如下：</p><p>第十次作业与第九次作业相比新增了Group，在MyNetwork中调用MyGroup。我直到周四才开始动笔，此时同学们已经把雷区排得差不多了……于是在Group的方法上我采用了缓存法的形式。需要特别注意的是缓存法在addRelation时也要更新缓存，我采用的方式为为Group增加更新的检索方法：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    public void addRelation(int id1, int id2, int value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (people.containsKey(id1) &amp;&amp; people.containsKey(id2)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            relationSum += 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            valueSum += (2 * value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>而在计算方差时，则出现了过度化简导致误差的问题，同样需要注意。</p><p>另外需要注意的是初始化问题，HashMap默认容量为16，当当前的size超过容量×常数时就会进行扩容，而扩容操作需要耗费的时间较多，因此我直接将关系表初始化为8192容量。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="43-第十一次作业">4.3 第十一次作业<a aria-hidden="true" class="hash-link" href="#43-第十一次作业" title="Direct link to heading">​</a></h3><p>UML类图如下：</p><p>第十一次作业对算法的考察增加了：</p><ul><li>在queryBlockSum我采用了并查集，进而isCircle的复杂度降至O(1)；</li><li>queryMinPath则采用了堆优化的Dijkstra，没有手写堆，而是采用自带的PriorityQueue进行维护；</li><li>queryStrongLink原本在想要不要学tarjan，但发现助教给的标程复杂度很宽容，所以就用了两步BFS，特判第一次BFS找到的为直连路径的情况，我写了一个忽略某点的BFS函数：</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private boolean searchIgnore(int id1, int id2, int ignore) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (id1 == ignore || id2 == ignore || id1 == id2) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // err(&quot;meet id1 == ignore || id2 == ignore || id1 == id2&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HashSet&lt;Integer&gt; visited = new HashSet&lt;&gt;(1024);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Queue&lt;Integer&gt; queue = new LinkedList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue.add(id1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (!queue.isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int currentId = queue.poll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (visited.contains(currentId)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ArrayList&lt;Integer&gt; points = ((MyPerson) getPerson(currentId)).getAcquaintance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (Integer i : points) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (i == id2) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // err(&quot;Succeed! searchIgnore&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else if (!visited.contains(i) &amp;&amp; i != ignore) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue.offer(i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // err(&quot;queue update to &quot; + queue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        visited.add(currentId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // err(&quot;point &quot; + currentId + &quot; has been searched&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>如果第一次找到的路径长度为2，那么就遍历起点的邻接表，找到一条不经过起点就能到终点的路径就返回成功；否则依次忽略第一次路径中的点，如果每次都能找到路径就返回成功。最后在研讨课也学了tarjan，在求割点的过程中求出所有双连通分量，进而判断点双。</p><p>这样的结构导致MyNetwork非常臃肿，我因此将并查集、堆优化的Dijkstra单独抽象为一个类。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="5-代码bug和修复情况">5. 代码bug和修复情况<a aria-hidden="true" class="hash-link" href="#5-代码bug和修复情况" title="Direct link to heading">​</a></h2><p>第九次、第十一次作业均未出现Bug。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="第十次作业">第十次作业<a aria-hidden="true" class="hash-link" href="#第十次作业" title="Direct link to heading">​</a></h3><p>第九次作业整体相对简单，也就让我放松了警惕，在第十次作业时，我最后改了一行代码，却忘了测试：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">return (HashSet&lt;Integer&gt;) acquaintance.keySet();</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>就是这行代码，让我直接RE了大部分测试点……在编写时想当然地以为HashMap的KeySet可以用强制类型转换为HashSet，之后又没有做哪怕一次对isCircle的测试，于是强测直接爆炸……在互测屋里，看到了没有除零直接RE的同学；看到了缓存更新不及时的同学，看到了好多Bug一起犯的同学……是一次难忘的体验。</p><p><img src="https://pic.downk.cc/item/5ec73f83c2a9a83be528b8bc.png"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="第十一次作业">第十一次作业<a aria-hidden="true" class="hash-link" href="#第十一次作业" title="Direct link to heading">​</a></h3><p>在第十一次作业，吸取了第十次作业的惨痛教训，用Junit对新加入的函数进行单元测试，优化算法，没有出现Bug。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="对规格的心得体会">对规格的心得体会<a aria-hidden="true" class="hash-link" href="#对规格的心得体会" title="Direct link to heading">​</a></h2><p>JML作为一种统一的规格化语言，在对代码进行了形式化的表述的同时，也给机器理解程序提供了一种可能性。</p><p>虽然从目前来看，JML相关的工具或是陈旧不堪，或是Bug满天飞，而撰写规格甚至比写程序还要复杂得多，比如对于一些Contains方法，JML的表述虽然严谨，但为人的阅读与理解提供了更大的负担。</p><p>而在未来的工作中，不单要知道如何写好程序，也需要写出好的文档，我想本单元的学习就是一次预习，虽然中间由于我的懈怠造成了大翻车，但这一单元只要认真阅读代码并不难。</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>这是一篇从Hexo迁移的文章，创建于2020-05-21 18:10:06</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/BUAA/课程/软件工程/CSDN App 案例分析"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->CSDN App 案例分析.md</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/BUAA/课程/面向对象设计与构造/OO-第二单元总结"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2020 OO 第二单元总结<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-jml语言理论基础与工具链" class="table-of-contents__link toc-highlight">1. JML语言理论基础与工具链</a><ul><li><a href="#11-jml语言是什么" class="table-of-contents__link toc-highlight">1.1 JML语言是什么</a></li><li><a href="#12-jml语言基本语法" class="table-of-contents__link toc-highlight">1.2 JML语言基本语法</a></li><li><a href="#13-应用工具链情况" class="table-of-contents__link toc-highlight">1.3 应用工具链情况</a></li></ul></li><li><a href="#2-smt-solver验证" class="table-of-contents__link toc-highlight">2. SMT Solver验证</a></li><li><a href="#3-jmlunitngjmlunit自动生成测试用例" class="table-of-contents__link toc-highlight">3. JMLUnitNG/JMLUnit自动生成测试用例</a></li><li><a href="#4-架构设计梳理与模型构建策略分析" class="table-of-contents__link toc-highlight">4. 架构设计梳理与模型构建策略分析</a><ul><li><a href="#41-第九次作业" class="table-of-contents__link toc-highlight">4.1 第九次作业</a></li><li><a href="#42-第十次作业" class="table-of-contents__link toc-highlight">4.2 第十次作业</a></li><li><a href="#43-第十一次作业" class="table-of-contents__link toc-highlight">4.3 第十一次作业</a></li></ul></li><li><a href="#5-代码bug和修复情况" class="table-of-contents__link toc-highlight">5. 代码bug和修复情况</a><ul><li><a href="#第十次作业" class="table-of-contents__link toc-highlight">第十次作业</a></li><li><a href="#第十一次作业" class="table-of-contents__link toc-highlight">第十一次作业</a></li></ul></li><li><a href="#对规格的心得体会" class="table-of-contents__link toc-highlight">对规格的心得体会</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.8b4ddefc.js"></script>
<script src="/assets/js/main.5eda9060.js"></script>
</body>
</html>